app-id: io.github.Snaggly.PS2_Pnacher
runtime: org.gnome.Platform
runtime-version: '42'
sdk: org.gnome.Sdk
command: ps2pnacher
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
cleanup:
  - '/include'
  - '/lib/pkgconfig'
  - '/share/aclocal'
  - '/share/doc'
  - '/share/gtk-doc'
  - '/share/info'
  - '/share/man'
  - '/share/pkgconfig'
  - '/lib/cmake'
  - '*.la'
  - '*.a'
modules:
  - name: ps2pnacher
    buildsystem: cmake-ninja
    config-opts:
    - -DCMAKE_BUILD_TYPE=Release
    sources:
      - type: git
        url: 'https://github.com/Snaggly/PS2_Pnacher.git'
        tag: 1.0
        commit: 6f23e70234ff3f48ed27d304413d7900c259442c
      - type: patch
        path: ps2pnacher_flatpak.patch
      - type: patch
        path: fix-icon-dimensions.patch
    post-install:
        - install -Dm644 flatpak/io.github.Snaggly.PS2_Pnacher.metainfo.xml /app/share/metainfo/io.github.Snaggly.PS2_Pnacher.metainfo.xml
    modules:
      - name: glibmm
        buildsystem: meson
        config-opts:
          - -Dbuild-documentation=false
          - -Dbuild-examples=false
        sources:
          - type: archive
            url: 'https://download.gnome.org/sources/glibmm/2.66/glibmm-2.66.4.tar.xz'
            sha256: 199ace5682d81b15a1d565480b4a950682f2db6402c8aa5dd7217d71edff81d5
        cleanup:
          - '/lib/glibmm*'
          - '/lib/giomm*'
        modules:
          - name: mm-common
            buildsystem: meson
            sources:
              - type: archive
                url: 'https://download.gnome.org/sources/mm-common/1.0/mm-common-1.0.4.tar.xz'
                sha256: e954c09b4309a7ef93e13b69260acdc5738c907477eb381b78bb1e414ee6dbd8
            cleanup:
              - '*'

          - name: libsigc++
            buildsystem: meson
            config-opts:
              - -Dbuild-documentation=false
              - -Dbuild-examples=false
            sources:
              - type: archive
                url: 'https://download.gnome.org/sources/libsigc++/2.10/libsigc++-2.10.8.tar.xz'
                sha256: 235a40bec7346c7b82b6a8caae0456353dc06e71f14bc414bcc858af1838719a
            cleanup:
              - '/lib/sigc++*'

      - name: gtkmm
        buildsystem: meson
        config-opts:
          - -Dbuild-documentation=false
        sources:
          - type: archive
            url: 'https://download.gnome.org/sources/gtkmm/3.24/gtkmm-3.24.6.tar.xz'
            sha256: 4b3e142e944e1633bba008900605c341a93cfd755a7fa2a00b05d041341f11d6
        cleanup:
          - '/lib/gdkmm*'
          - '/lib/gtkmm*'
        modules:

          - name: atkmm
            buildsystem: meson
            config-opts:
              - -Dbuild-documentation=false
            sources:
              - type: archive
                url: 'https://download.gnome.org/sources/atkmm/2.28/atkmm-2.28.3.tar.xz'
                sha256: 7c2088b486a909be8da2b18304e56c5f90884d1343c8da7367ea5cd3258b9969
            cleanup:
              - '/lib/atkmm*'

          - name: cairomm
            config-opts:
              - --disable-documentation
            sources:
              - type: archive
                url: 'https://gitlab.freedesktop.org/cairo/cairomm/-/archive/1.14.3/cairomm-1.14.3.tar.gz'
                sha256: 7dab16c5698acb284f178048337465b463fbed01c49e10bfe48acb0a852d873e
            post-install:
              - install -Dm644 -t /app/share/licenses/cairomm COPYING
            cleanup:
              - '/lib/cairomm*'

          - name: pangomm
            buildsystem: meson
            config-opts:
              - -Dbuild-documentation=false
            sources:
              - type: archive
                url: 'https://download.gnome.org/sources/pangomm/2.46/pangomm-2.46.2.tar.xz'
                sha256: 57442ab4dc043877bfe3839915731ab2d693fc6634a71614422fb530c9eaa6f4
            cleanup:
              - '/lib/pangomm*'

      - name: libcdio
        sources:
          - type: archive
            url: 'https://ftp.gnu.org/gnu/libcdio/libcdio-2.1.0.tar.bz2'
            sha256: 8550e9589dbd594bfac93b81ecf129b1dc9d0d51e90f9696f1b2f9b2af32712b
        post-install:
            - install -Dm644 -t /app/share/licenses/libcdio COPYING
        cleanup:
            - '/bin/*'
